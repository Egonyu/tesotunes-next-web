{
  "project": "Music Platform - Artists & Songs Domain References Report",
  "created_at": "2025-11-05T11:51:00Z",
  "scope": "All references to Artists and Songs across codebase",
  
  "summary": {
    "models_found": ["Artist", "Song"],
    "tables_found": ["artists", "songs"],
    "no_track_model_found": true,
    "no_tracks_table_found": true,
    "primary_inconsistency": "Model $fillable arrays contain columns that don't exist in migrations"
  },
  
  "file_classifications": {
    "models": {
      "files": [
        "app/Models/Artist.php",
        "app/Models/Song.php"
      ],
      "status": "Partially inconsistent with migrations"
    },
    
    "migrations": {
      "files": [
        "database/migrations/2025_01_10_000002_create_user_system_tables.php (artists table)",
        "database/migrations/2025_01_10_000003_create_music_content_tables.php (songs table)"
      ],
      "status": "Canonical source of truth"
    },
    
    "factories": {
      "files": [
        "database/factories/ArtistFactory.php",
        "database/factories/SongFactory.php"
      ],
      "inconsistencies": [
        "ArtistFactory uses 'total_plays_cached' and 'total_revenue_cached' which are in migration but not model $fillable",
        "SongFactory appears consistent - uses canonical names"
      ]
    },
    
    "controllers": {
      "files_using_artists": [
        "app/Http/Controllers/Admin/ArtistVerificationController.php",
        "app/Http/Controllers/Backend/Admin/MusicController.php",
        "app/Http/Controllers/Api/Music/UploadController.php"
      ],
      "files_using_songs": [
        "app/Http/Controllers/Api/Music/UploadController.php",
        "app/Http/Controllers/Api/MusicController.php",
        "app/Http/Controllers/Api/Mobile/MobileDownloadController.php",
        "app/Http/Controllers/Backend/Admin/BulkUploadController.php",
        "app/Http/Controllers/Backend/Admin/MusicController.php",
        "app/Http/Controllers/Api/MobileContentController.php"
      ],
      "known_issues": [
        {
          "file": "app/Http/Controllers/Api/Music/UploadController.php",
          "line_approx": 157,
          "issue": "Uses 'audio_file_original' correctly",
          "status": "CORRECT"
        },
        {
          "file": "app/Http/Controllers/Api/MusicController.php",
          "line_approx": 30,
          "issue": "Accesses $song->audio_file_original correctly",
          "status": "CORRECT"
        },
        {
          "file": "app/Http/Controllers/Api/Mobile/MobileDownloadController.php",
          "line_approx": 88,
          "issue": "Uses $song->audio_file_320 and $song->audio_file_128 correctly",
          "status": "CORRECT"
        }
      ]
    },
    
    "services": {
      "files": [
        "app/Services/SongService.php",
        "app/Services/ActivityService.php",
        "app/Services/AdService.php"
      ],
      "status": "Needs verification for column name usage"
    },
    
    "tests": {
      "files": [
        "tests/Unit/Services/SongServiceTest.php",
        "tests/Unit/PodcastModuleTest.php"
      ],
      "status": "Need to verify tests use canonical column names"
    },
    
    "views_and_resources": {
      "status": "Blade templates and API resources likely use model accessors, which provide backward compatibility"
    }
  },
  
  "detailed_inconsistencies": {
    "artist_model": [
      {
        "type": "missing_from_fillable",
        "columns": ["total_plays_cached", "total_revenue_cached", "earnings_balance", "payout_phone_number", "distribution_suspended"],
        "severity": "MODERATE",
        "impact": "These columns exist in DB but cannot be mass-assigned via create() or update() unless added to $fillable",
        "files_affected": [
          "app/Models/Artist.php",
          "database/factories/ArtistFactory.php (uses them but model doesn't allow)"
        ],
        "fix_required": "Add to $fillable array in Artist.php"
      }
    ],
    
    "song_model": [
      {
        "type": "fillable_column_not_in_db",
        "columns": ["audio_file", "file_path", "file_path_128", "file_path_320", "preview_path"],
        "severity": "HIGH",
        "impact": "Model allows mass-assignment of non-existent columns. May cause silent failures or unexpected behavior.",
        "actual_db_columns": ["audio_file_original", "audio_file_128", "audio_file_320", "audio_file_preview"],
        "files_affected": ["app/Models/Song.php"],
        "fix_required": "Remove from $fillable array"
      },
      {
        "type": "fillable_column_not_in_db",
        "columns": ["duration"],
        "severity": "MODERATE",
        "impact": "Model has accessor getDurationAttribute() for backward compat. But 'duration' should not be in $fillable.",
        "actual_db_column": "duration_seconds",
        "files_affected": ["app/Models/Song.php"],
        "fix_required": "Remove 'duration' from $fillable, keep accessor"
      },
      {
        "type": "fillable_column_not_in_db",
        "columns": ["unique_listeners"],
        "severity": "MODERATE",
        "impact": "DB column is 'unique_listeners_count' not 'unique_listeners'",
        "actual_db_column": "unique_listeners_count",
        "files_affected": ["app/Models/Song.php"],
        "fix_required": "Remove from $fillable"
      },
      {
        "type": "fillable_column_not_in_db",
        "columns": ["revenue"],
        "severity": "MODERATE",
        "impact": "DB column is 'revenue_generated' not 'revenue'",
        "actual_db_column": "revenue_generated",
        "files_affected": ["app/Models/Song.php"],
        "fix_required": "Remove from $fillable"
      },
      {
        "type": "fillable_column_not_in_db",
        "columns": ["allow_downloads"],
        "severity": "MODERATE",
        "impact": "DB column is 'is_downloadable' not 'allow_downloads'",
        "actual_db_column": "is_downloadable",
        "files_affected": ["app/Models/Song.php"],
        "fix_required": "Remove from $fillable (already has is_downloadable)"
      },
      {
        "type": "fillable_column_not_in_db",
        "columns": ["credits", "local_genres", "cultural_context"],
        "severity": "LOW",
        "impact": "These appear to be planned columns but don't exist in migration",
        "actual_db_column": "Migration has 'additional_credits' but not 'credits'",
        "files_affected": ["app/Models/Song.php"],
        "fix_required": "DECISION NEEDED: Add columns to DB or remove from model"
      }
    ],
    
    "casts_inconsistencies": {
      "song_model": [
        {
          "cast_key": "duration",
          "issue": "Casts array doesn't have 'duration', but it's accessed via accessor",
          "fix": "Ensure 'duration_seconds' => 'integer' is in casts"
        },
        {
          "cast_key": "unique_listeners",
          "issue": "If cast exists for 'unique_listeners', it should be for 'unique_listeners_count'",
          "fix": "Verify and correct"
        },
        {
          "cast_key": "revenue",
          "issue": "If cast exists for 'revenue', it should be for 'revenue_generated'",
          "fix": "Verify and correct"
        }
      ]
    }
  },
  
  "accessor_patterns_that_are_correct": [
    {
      "model": "Song",
      "accessor": "getDurationAttribute()",
      "purpose": "Returns $this->duration_seconds for backward compatibility",
      "status": "INTENTIONAL - Keep this, it's not a bug"
    },
    {
      "model": "Song",
      "accessor": "getAudioFileAttribute()",
      "purpose": "Returns $this->audio_file_original for backward compatibility",
      "status": "INTENTIONAL - Keep this, it's not a bug"
    }
  ],
  
  "search_results": {
    "track_vs_song_usage": {
      "tracks_table_references": 0,
      "Track_model_references": "Only in comments like 'NO TRACKS TABLE!' in migration",
      "songs_table_references": "Consistent throughout",
      "Song_model_references": "Consistent throughout"
    },
    
    "column_name_usage_in_controllers": {
      "audio_file_original": "Used correctly in upload controllers",
      "audio_file_320": "Used correctly in download controllers",
      "audio_file_128": "Used correctly in download controllers",
      "audio_file_preview": "Used correctly",
      "duration_seconds": "Need to verify all code uses this, not 'duration'",
      "revenue_generated": "Need to verify all code uses this, not 'revenue'"
    }
  },
  
  "no_ambiguous_mappings": {
    "track_vs_song": "NO AMBIGUITY - 'song' is the only canonical name",
    "artist_variations": "NO AMBIGUITY - 'artist' is the only name used"
  },
  
  "recommendations": {
    "priority_1_critical": [
      "Clean up Song model $fillable to remove all non-existent columns",
      "Add missing columns to Artist model $fillable"
    ],
    "priority_2_important": [
      "Verify $casts arrays use canonical column names",
      "Search codebase for any direct assignments to wrong column names"
    ],
    "priority_3_nice_to_have": [
      "Decide on 'credits', 'local_genres', 'cultural_context' columns",
      "Add comprehensive documentation of accessor patterns",
      "Add linter to prevent future divergence"
    ]
  }
}
